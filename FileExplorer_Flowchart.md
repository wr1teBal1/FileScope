# 类Windows资源管理器程序流程图

## 系统架构（三层架构）

```
+-------------------+      +-------------------+      +-------------------+
|     表示层        |      |      业务层       |      |      数据层       |
+-------------------+      +-------------------+      +-------------------+
| - 主窗口          |      | - 文件管理器      |      | - 文件系统接口    |
| - 视图控制器      | <--> | - 路径管理        | <--> | - 文件操作实现    |
| - 工具栏/菜单     |      | - 权限管理        |      | - 元数据存储      |
| - 状态栏          |      | - 搜索引擎        |      | - 配置持久化      |
| - 对话框系统      |      | - 插件系统        |      | - 缓存机制        |
+-------------------+      +-------------------+      +-------------------+
         ^                          ^                         ^
         |                          |                         |
         v                          v                         v
+-------------------+      +-------------------+      +-------------------+
|    SDL/UI库       |      |   工具类库/算法   |      |   系统API调用     |
+-------------------+      +-------------------+      +-------------------+
```

## 模块详细设计

### 1. 核心模块

#### 1.1 程序初始化模块
- SDL初始化
  - 视频子系统初始化
  - 事件子系统初始化
  - 字体子系统初始化
  - 图像加载子系统初始化
- 窗口创建与管理
  - 窗口属性设置
  - 渲染器创建
  - 图标设置
- 配置加载
  - 用户配置文件读取
  - 默认配置初始化
  - 配置合并与验证
- 资源管理
  - 图标资源加载
  - 主题样式加载
  - 语言包加载

#### 1.2 文件系统模块
- 文件操作API
  - 基本操作封装（打开/创建/读/写/关闭）
  - 目录遍历实现
  - 权限检查机制
- 文件信息管理
  - 基本信息获取（大小/类型/日期）
  - 文件属性读取与设置
  - 文件图标关联
- 文件监视器
  - 目录变化监听
  - 自动刷新机制
  - 变化通知系统
- 路径管理
  - 路径解析与规范化
  - 相对路径转换
  - 特殊文件夹映射

#### 1.3 UI渲染模块
- 基础渲染引擎
  - 绘图原语（线/矩形/圆形）
  - 文本渲染
  - 纹理管理
- 控件系统
  - 按钮绘制
  - 列表控件
  - 树形控件
  - 分割窗口
  - 滚动条
- 文件列表渲染
  - 图标视图
  - 列表视图
  - 详细信息视图
  - 缩略图生成与缓存
- 主题系统
  - 颜色方案
  - 字体管理
  - 控件样式

#### 1.4 事件处理模块
- 事件分发系统
  - 窗口事件处理
  - 鼠标事件处理
  - 键盘事件处理
- 用户操作响应
  - 点击处理
  - 双击处理
  - 拖放操作
  - 右键菜单
- 命令模式实现
  - 命令对象
  - 命令历史
  - 撤销/重做支持

#### 1.5 文件操作模块
- 文件复制系统
  - 进度跟踪
  - 冲突解决
  - 错误处理
- 文件移动系统
  - 同分区优化
  - 权限验证
- 删除操作
  - 回收站支持
  - 永久删除确认
- 批量操作
  - 多文件选择
  - 批处理队列
  - 中断恢复

#### 1.6 搜索功能模块
- 搜索引擎
  - 文件名匹配
  - 内容搜索
  - 正则表达式支持
- 搜索结果显示
  - 结果分组
  - 结果排序
  - 结果预览
- 高级过滤器
  - 按类型过滤
  - 按大小过滤
  - 按日期过滤

#### 1.7 配置系统
- 用户偏好管理
  - 视图设置
  - 排序设置
  - 显示选项
- 配置持久化
  - 配置文件格式
  - 读写操作
- 快捷键管理
  - 默认映射
  - 自定义支持

### 2. 扩展模块

#### 2.1 插件系统
- 插件接口定义
- 插件加载机制
- 插件管理UI

#### 2.2 文件预览模块
- 文本预览
- 图像预览
- 媒体文件预览

#### 2.3 网络文件支持
- 网络路径解析
- 网络文件操作适配
- 共享文件夹浏览

#### 2.4 压缩文件支持
- 压缩文件识别
- 压缩文件浏览
- 解压缩操作

## 执行流程图（详细）

### 应用程序主流程

```
[程序入口点]
    |
    v
[初始化配置子系统]
    |
    v
[加载用户配置]
    |
    v
[初始化SDL和图形子系统]
    |
    v
[创建主窗口]
    |
    v
[加载资源]--+
    |       |
    |       v
    |   [加载图标库]
    |       |
    |       v
    |   [加载界面主题]
    |       |
    v       v
[注册事件处理器]
    |
    v
[初始化文件系统模块]
    |
    v
[加载初始目录]
    |
    v
+---[主事件循环]<-------------------------------------------+
|   |                                                        |
|   v                                                        |
|  [SDL事件队列处理]                                         |
|   |                                                        |
|   +--->[窗口事件]---->[处理窗口大小调整/关闭等]           |
|   |                                                        |
|   +--->[鼠标事件]---->[处理点击/拖放/滚轮等]              |
|   |                                                        |
|   +--->[键盘事件]---->[处理快捷键/导航等]                 |
|   |                                                        |
|   +--->[自定义事件]-->[处理文件系统变化通知等]            |
|   |                                                        |
|   v                                                        |
|  [更新应用状态]                                           |
|   |                                                        |
|   +--->[更新文件列表]                                     |
|   |                                                        |
|   +--->[更新UI状态]                                       |
|   |                                                        |
|   +--->[处理后台任务]-->[文件操作进度更新]                |
|   |                                                        |
|   v                                                        |
|  [渲染UI]                                                 |
|   |                                                        |
|   +--->[清除背景]                                         |
|   |                                                        |
|   +--->[绘制导航栏]                                       |
|   |                                                        |
|   +--->[绘制目录树]                                       |
|   |                                                        |
|   +--->[绘制文件列表]                                     |
|   |                                                        |
|   +--->[绘制状态栏]                                       |
|   |                                                        |
|   +--->[绘制对话框/菜单]                                  |
|   |                                                        |
|   v                                                        |
|  [呈现到屏幕]                                             |
|   |                                                        |
|   +------------------------------------------------------>+
    |
    v
[清理资源]
    |
    v
[保存用户配置]
    |
    v
[释放SDL资源]
    |
    v
[程序结束]
```

### 文件操作详细流程

```
[用户选择文件/文件夹]
    |
    v
[显示右键菜单/工具栏选项]
    |
    +------------------------+------------------------+------------------------+------------------------+------------------------+
    |                        |                        |                        |                        |                        |
    v                        v                        v                        v                        v                        v
[打开]                    [复制]                    [剪切]                   [删除]                   [重命名]                 [属性]
    |                        |                        |                        |                        |                        |
    v                        v                        v                        v                        v                        v
[检查文件类型]           [复制到缓冲区]            [标记为剪切]            [检查删除模式]            [进入编辑模式]          [收集文件信息]
    |                        |                        |                        |                        |                        |
    +---+---+---+            |                        |                        +------------+           |                        +-------+-------+
    |   |   |   |            |                        |                        |            |           |                        |       |       |
    v   v   v   v            v                        v                        v            v           v                        v       v       v
[目录][文本][图像][其它]  [用户选择目标位置]       [用户选择目标位置]     [回收站]     [永久删除]   [验证新名称]           [基本信息][权限信息][扩展信息]
    |   |   |   |            |                        |                        |            |           |                        |       |       |
    v   v   v   v            v                        v                        v            v           v                        v       v       v
[打开][关联][预览][关联]   [验证权限]               [验证权限]             [移至回收站] [确认对话框] [检查冲突]            [显示属性对话框]
目录  程序  窗口  程序        |                        |                        |            |           |                        |
                             v                        v                        v            v           v                        v
                         [创建任务对象]           [创建任务对象]           [执行删除]    [执行删除]  [更新文件名]           [允许修改属性]
                             |                        |                        |            |           |                        |
                             v                        v                        v            v           v                        v
                         [添加到任务队列]         [添加到任务队列]        [更新文件列表] [更新文件列表][更新文件列表]        [应用更改]
                             |                        |                                                                         |
                             v                        v                                                                         v
                         [显示进度窗口]           [显示进度窗口]                                                          [更新文件列表]
                             |                        |
                             v                        v
                         [执行复制操作]           [执行移动操作]
                             |                        |
                             +------------------------+
                                        |
                                        v
                                   [处理错误/冲突]
                                        |
                                        v
                                   [更新文件列表]
```

### 文件系统监视流程

```
[初始化文件监视器]
    |
    v
[注册目录监视]<------+
    |                |
    v                |
[等待文件系统事件]   |
    |                |
    v                |
[接收变化通知]       |
    |                |
    +---+---+---+    |
    |   |   |   |    |
    v   v   v   v    |
[创建][修改][删除][重命名]
    |   |   |   |    |
    v   v   v   v    |
[添加][更新][移除][更新]
 项目  项目  项目  项目
    |   |   |   |    |
    +---+---+---+    |
        |            |
        v            |
[发送更新通知]       |
    |                |
    v                |
[当前目录变化?]      |
    |                |
    +---+            |
    Yes |            |
    |   |            |
    v   | No         |
[刷新UI]             |
    |                |
    +----------------+
```

## 数据设计

### 文件项目数据结构
```
struct FileItem {
    char*           name;               // 文件名
    char*           fullPath;           // 完整路径
    FileAttributes  attributes;         // 文件属性
    uint64_t        size;               // 文件大小
    time_t          creationTime;       // 创建时间
    time_t          modificationTime;   // 修改时间
    time_t          accessTime;         // 访问时间
    SDL_Texture*    icon;               // 文件图标
    bool            isSelected;         // 是否被选中
    FileType        type;               // 文件类型
};
```

### 目录树节点结构
```
struct DirectoryNode {
    char*           name;               // 目录名
    char*           fullPath;           // 完整路径
    DirectoryNode** children;           // 子目录列表
    int             childCount;         // 子目录数量
    int             capacity;           // 容量
    bool            isExpanded;         // 是否展开
    bool            isSelected;         // 是否被选中
    SDL_Texture*    icon;               // 目录图标
};
```

### 用户界面组件
```
struct UIComponent {
    SDL_Rect        bounds;             // 位置和大小
    bool            isVisible;          // 是否可见
    bool            isEnabled;          // 是否启用
    void            (*render)(void*);   // 渲染函数
    bool            (*handleEvent)(SDL_Event*); // 事件处理函数
    void*           data;               // 组件数据
};
```

## 开发路线图

### 1. 项目准备阶段
- 环境搭建
  - 安装g++编译器
  - 安装SDL2开发库和相关扩展
  - 配置CMake构建系统
  - 设置版本控制
- 项目结构设计
  - 创建目录结构
  - 设置模块边界
  - 配置构建脚本

### 2. 核心架构开发
- 基础框架实现
  - SDL初始化和窗口创建
  - 事件循环框架
  - 基本UI渲染系统
- 文件系统接口
  - 基本文件操作封装
  - 目录遍历实现
  - 文件信息获取

### 3. 用户界面开发
- 基础UI控件实现
  - 按钮控件
  - 列表控件
  - 树形控件
  - 滚动条
- 主界面布局
  - 导航栏实现
  - 目录树实现
  - 文件列表实现
  - 状态栏实现
- 不同视图模式
  - 图标视图
  - 列表视图
  - 详细信息视图

### 4. 文件操作功能实现
- 基本文件操作
  - 文件打开
  - 文件复制
  - 文件移动
  - 文件删除
- 高级文件操作
  - 批量操作
  - 进度显示
  - 错误处理
  - 冲突解决

### 5. 高级功能开发
- 搜索系统
  - 文件名搜索
  - 内容搜索
  - 过滤功能
- 文件预览
  - 文本预览
  - 图像预览
- 配置系统
  - 用户设置保存
  - 界面定制选项

### 6. 扩展功能
- 压缩文件支持
- 网络文件支持
- 插件系统

### 7. 优化与测试
- 性能优化
  - 渲染优化
  - 内存使用优化
- 用户体验提升
  - 快捷键支持
  - 拖放操作
- 测试与调试
  - 单元测试
  - 集成测试
  - 性能测试

### 8. 发布和部署
- 构建系统完善
  - 发布构建配置
  - 依赖管理
- 安装程序创建
- 文档编写

## 技术栈

- **编程语言**: C语言
- **图形库**: SDL2
- **构建系统**: CMake/Make
- **编译器**: g++
- **其他库**:
  - SDL2_image: 图像加载
  - SDL2_ttf: 字体渲染
  - zlib: 压缩文件支持
  - libarchive: 高级压缩文件处理 